% "Станет проще"

\documentclass[a4paper,12pt]{article} % тип документа

% report, book

% Рисунки
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{lscape}
\usepackage{biblatex}
\usepackage{diagbox}
\usepackage{capt-of}

\usepackage{hyperref}
\usepackage[rgb]{xcolor}
\hypersetup{				% Гиперссылки
    colorlinks=true,       	% false: ссылки в рамках
	urlcolor=blue          % на URL
}

%  Русский язык

\usepackage[T2A]{fontenc}			% кодировка
\usepackage[utf8]{inputenc}			% кодировка исходного текста
\usepackage[english,russian]{babel}	% локализация и переносы


% Математика
\usepackage{amsmath,amsfonts,amssymb,amsthm,mathtools} 
\DeclarePairedDelimiter\abs{\lvert}{\rvert}%

\renewcommand{\labelitemi}{\textendash}
\renewcommand{\labelitemii}{\textbullet}

\addbibresource{tex.bib}

\usepackage{wasysym}

%Заговолок
\author{Поляченко Юрий Анатольевич}
\title{Количественная оценка погрешности определения газонасыщенности по подтверждениям качественного характера \\ \emph{\small (Численное исследование на основе теории вероятностей и решение задачи количественной оценки погрешности определения газонасыщенности Кг пластов методом <<ММНК-Кг>> по качественным результатам испытаний)}}
\date{\today}

\begin{document} % начало документа

\clearpage\maketitle
\thispagestyle{empty}

\newpage

\tableofcontents

\newpage

\section{Постановка задачи}

\subsection{Геофизическая постановка задачи}

Газовая скважина исследована аппаратурой мультиметодного многозондового нейтронного каротажа (ММНК) и по методике ММНК-Кг определены $N$ значений коэффициента газонасыщенности \emph{Кг} в разных пластах разреза. После этого  с целью проверки корректности всей технологии проводятся испытания скважины на приток, в которых на качественном уровне измеряется состав фактически добываемой продукции газоводяной смеси. Это означает, что продукция классифицируется на небольшое число градаций $M \sim$ 3--5 разбиений шкалы \emph{Кг} на эквидистантные широкие интервалы протяженностью по $\Delta$\emph{Кг}= [\emph{Кг}] / $M$, где [\emph{Кг}] – максимально возможный диапазон изменения \emph{Кг} в исследуемых геолого-промысловых условиях. Например, наиболее часто используемыми интервалами изменения $\Delta$\emph{Кг} для типовых [\emph{Кг}] = [0,1], $M$ = 4 являются по терминологии газовиков:  <<вода (0--0.25), вода+газ (0.25--0.5), газ+вода (0.5--0.75), газ (0.75--1)>>. Затем проверяются доли $p_0$, \% правильных попаданий предсказанных ММНК-Кг численных значений \emph{Кг} в соответствующие им широкие интервалы $\Delta$\emph{Кг}. Если большинство этих долей $p_0$ > 80-90\%, то технология признается корректной, т.к. получила качественное подтверждение по результатам испытаний, считающихся одним из наиболее прямых и убедительных способов тестирования методик в скважинной геофизике.
Представляется очевидным, что при достаточно большом числе $N \gg M$ определений \emph{Кг} и, разумеется, при условии выполнения достаточно жесткого критерия подтверждаемости по $p_0$ любая разумно введенная оценка фактической средней погрешности определения \emph{Кг}   должна дать величину, существенно меньшую широких интервалов разбиения $\Delta$\emph{Кг}. Другими словами, это означает, что технологию ММНК можно будет переквалифицировать из качественной по способу ее подтверждения в количественную по фактически достигаемому уровню погрешности определения \emph{Кг}. 

Поэтому задачами работы явились следующие:

\begin{itemize}
\item численное обоснование этого утверждения на основе теории вероятностей с разработкой алгоритма и программы расчета фактической средней погрешности определения \emph{Кг} по всем имеющимся данным определений и подтверждений в исследуемой скважине;

\item численное изучение поведения погрешности в зависимости от варьируемых параметров $M$, $N$, [\emph{Кг}], $p_0$ и характера вероятностного  распределения найденных значений \emph{Кг} на  [\emph{Кг}], $P$(\emph{Кг}) - от равномерного до гауссового с большой дисперсией. Диапазоны изменения варьируемых параметров: 

\begin{itemize}
\item $M = 3, 4, 5$
\item $M \leq N \leq 30$
\item $ $[\emph{Кг}] = [0.5, 1], [0.25, 1], [0, 1]
\item $p_0 = 80\%, 90\%, \approx 100\%$
\end{itemize}

\item выдача практических рекомендаций по выбору единственного управляемого параметра $N$ в зависимости от априори задаваемых геофизиками и газовиками параметров $M$  и [\emph{Кг}], а также от фактически получившихся характеристик – распределения $P$(\emph{Кг})  и значений $p_0$ в результате сопоставления определений и подтверждений \emph{Кг}.

\end{itemize}

\subsection{Математическая формулировка}

Цель -- предсказать погрешность $\varepsilon_0$ выдаваемых нашей программой значений $x$ искомого параметра $y$.

Область изменения $x \in $ [\emph{Кг}] разбита на интервалы $[a_j; b_j]$, $j \in \left\{\overline{1,M}\right\}$, для каждого из которых есть $N_j$ экспериментов. Считается, что искомая погрешность $\varepsilon_0$ может меняться от интервала к интервалу, но постоянная внутри интервала (т.е. точнее писать $\varepsilon_{0j}$). Фиксируем $j$ и работаем в выбранном интервале, поэтому далее индекс интервала $j$ опущен.

Есть $N$ экспериментов, про которые известно, что в каждом из них истинное значение $y_i$ попало в интервал, т.е. $y_i \in [a;b]$ $\forall i \in \left\{\overline{1,N}\right\}$. На каждый из этих экспериментов у нас есть результат работы нашей программы $x_i$. Предполагается, что истинное значение $y_{i}$ распределено по Гауссу со средним $x_i$ и некой дисперсией $\varepsilon$, т.е.

\begin{equation}
\dfrac{\mathcal{P}(y_i \in [t, t+dt])}{dt} = g(t, x_i, \varepsilon), 
\end{equation}

где $\mathcal{P}(A)$ - вероятность того, что $A$ верно, а

\begin{equation}
g(x, \mu, \sigma) = \dfrac{1}{\sigma \sqrt{2 \pi}} \exp{\left[ - \dfrac{1}{2} \left( \dfrac{x - \mu}{\sigma} \right)^2 \right]}
\end{equation}

-- Гауссово распределение.

Ищем зависимость

\begin{equation}
\varepsilon_0 \left( a, b, \{x_i\}_{i = 1}^{N}, p_0 \right)
\end{equation}

такую, что вероятность реализации описанной выше ситуации (т.е. что все истинные значения попали в интервал) $ = p_0$, т.е.

\begin{equation}
\mathcal{P}(\forall x \in [a;b] \hspace{5pt} |x - y| < \varepsilon_0) = p_0
\end{equation}

Из сторонних соображений считается известным минимально возможная погрешность $\varepsilon_{min}$, т.е. если метод выдает $\varepsilon_0 < \varepsilon_{min}$, то считаем $\varepsilon_0 = \varepsilon_{min}$.

\newpage

\section{Предлагаемое решение}

\subsection{Идея и приближения}

Задав $\varepsilon$, можно посчитать вероятность реализации ситуации, описанной в постановке -- попадания всех истинных значений параметра $y_i$, распределенных по Гауссу каждый около своего $x_i$, в интервал $[a;b]$. Далее предположение - эта вероятность равна нашей целевой вероятность $p_0$. Не очевидно, почему это должно выполняться точно (скорее всего это не выполняется), но для оценки предложено использовать такую модель. 

Поясним разумность данного выбора. Будем брать пробные $\varepsilon$ и смотреть как от этого зависит ожидаемое поведение истинных значений $y_i$ относительно наших точек $x_i$. Для примера возьмем весь интервал $[0.2; 0.5]$ и предположим что у нас имеются 5 точек, для которых наша программа выдала ответы 0.22, 0.3, 0.35, 0.4, 0.43. Если предположить, что погрешность наший предсказаний $\varepsilon = 0.02$, то плотность вероятности для каждого из 5 истинных значений будет выглядет так:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_med}
\end{center}
\caption{Разным цветам отвечают разные эксперименты. Для каждого эксперимента: проколотый круг на оси Х -- наше предсказание ответа, купол -- распределение плотности вероятности того, что истинное значение ответа примет значение $t$, в зависимости от $t$.} \label{img:peaks_med}
\end{figure}

На Рис. \ref{img:peaks_med} видно, что для всех точек кроме синей почти вся кривая (вероятность = площадь под кривой) находится в исследуемом интервале. Это значит, что при $\varepsilon = 0.02$ для всех точек кроме синей вероятность того, что интинное значение параметра попадет в интервал, равна почти 100\%. Синяя же точка находится на расстоянии $\sim 1 \sigma$ (в данном случае 0.02), что значит, что вероятность того, что истинное значение параметра в синем эксперименте попадет в интервал $[0.2; 0.5]$ будет $\approx 16 \%$. Попадания истинных значений в интервал -- события независимые, поэтому вероятность реализации картины в целом будет произведением вероятностей попадания каждого значения в интервал по отдельности. В нашем случае все вероятности кроме синей $\approx 1$, поэтому общая вероятность $\approx$ синяя вероятность $\approx$ 84\%. Это значит, что если бы погрешность нашей программы была 0.02, то вероятность случатся тому что случилось на рассматриваемых 5 экспериментах в совокупности была бы 84 \%. Поняв это, можно решить обратную задачу: сказать, что мы верим эксперименту на скажем 95\%, и найти такое $\varepsilon$, при котором вероятность его реализации как раз будет 95\%. Понятно, что задача решаема -- если в предыдущем примере мы возьмем $\varepsilon = 0.008$, то распределение вероятностей для истинных значений будет 

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_sharp_med}
\end{center}
\caption{Обозначения аналогичны Рис. \ref{img:peaks_med}. Вероятность реализации эксперимента >99\%, что эквивалентно практически полному доверию эксперименту.} \label{img:peaks_sharp_med}
\end{figure}

\newpage

Если же все наши экспериментальные точки лежат ближе к центру исследуемой области, то оценка на погрешность выходит грубой. Это понятно из следующего примера. Сдвинем точку 0.22 из предыдущего примера в точку 0.28. График для $\varepsilon = 0.04$ будет выглядить как

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_smooth}
\end{center}
\caption{Обозначения аналогичны Рис. \ref{img:peaks_med}. Вероятность реализации эксперимента 92.5\%.} \label{img:peaks_smooth}
\end{figure}

Т.е. при налиции точки 0.22, близкой к левой границе иследуемого интервала 0.2, вероятность реализации эксперимента уже при $\varepsilon = 0.02$ была 84\%, что говорило о том, что в реальности скорее всего погрешность была меньше. Здесь же даже при $\varepsilon = 0.04$ вероятность все еще >90\%. Это на самом деле логично, т.к. если все наши точки у центра интервала, то единственный известный нам факт (на котором и строится вся оценка опгрешности) о том, что все истинные значения попали в интервал, поволяет отбросить только самые большие значения погрешностей.

Заинтересовавшийся читатель может найти весь исходный код проекта и мои контакты для вопросов и предложений \href{https://github.com/PolyachenkoYA/errorEstimationIOGT}{здесь}. В частности по ссылке лежит программа для оценки ошибок по описываемому здесь методу.

Теперь приведем аналитическое выражение описанной идеи:

\newpage

\subsection{Аналитика}

Вероятность попадания $i$-ой истинной точки в интервал

\begin{equation}
p_i(\varepsilon) = \int\limits_a^b g \left(x, x_i, \varepsilon \right) dx = \int\limits_{(a-x_i)/\varepsilon}^{(b-x_i)/\varepsilon} g(x, 0, 1) dx.
\end{equation}

Введем функцию (известную как функция ошибок):

\begin{equation}
\textsf{erf}(x) = \int\limits_{- \infty}^x g(t, 0, 1) dt.
\end{equation}

Попадание каждого истинного значения в интервал - независимое событие, поэтому вероятность реализации нашей совокупности экспериментов

\begin{equation}
p(\varepsilon) = \prod_{i = 1}^N p_i(\varepsilon) = \prod_{i = 1}^N \left[ \textsf{erf} \left( \dfrac{b - x_i}{\varepsilon} \right) - \textsf{erf} \left( \dfrac{a - x_i}{\varepsilon} \right) \right]
\end{equation}

Для нахождения желаемого $\varepsilon_0$ решаем уравнение на $\varepsilon_0$ при заданном $p_0$.

\begin{equation}
p(\varepsilon_0) = p_0
\end{equation}

Уравнения явно не решается аналитически. Но несложно показать, что функция $p(\varepsilon)$ монотонна, а интервал изменения $\varepsilon$ известен и невелик, откуда следует, что уравнени легко решается численно даже самыми простейшими методами вроде деления отрезка пополам. В примерах использован алгоритм, реализованный в функции $fzero$ в Matlab и описанный в \cite{grund1979forsythe}

\newpage

\subsection{Продолжение примера аналитикой}

Продолжим использовать 5 точек из раздела 2.1. В разделе разделе 2.1 был описан алгоритм как мы задавшись определенным $\varepsilon$ можем оценить вероятность $p$, с которой при этом $\varepsilon$ реализовались бы имеющиеся у нас экспериментальные данные. Сделав так для мноих различных $\varepsilon$, можно для каждого из них получить свое значение $p(\varepsilon)$ (Синяя кривая на Рис. \ref{img:vis}).

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/vis}
\end{center}
\caption{Зависимость $p(\varepsilon)$ вероятности реализации эксперимента при данной погрешности программы. Красная линия -- принятая минимально возможная погрешность $\varepsilon_{min} = 0.02$, Синяя вертикаль -- найденная оценка, синяя горизонталь -- наш выбор $p_0 = 95\%$, зеленый пунктир - минимальное расстояние точек до границы.}
\label{img:vis}
\end{figure}

Видно, что наличие множества (> 1) точек позволяет улучшить оценку с очевидного значения минимального расстояния до границы -- синяя линяя линия левее зеленой, т.е. оценка по предлагаемому методу лучше чем наивная оценка сверху на глаз.

\newpage

\section{Результат применения}

\subsection{Типичные значения}

Можно исследовать, как оценка погрешности зависит от количества имеющихся экспериментальных данных в <<усредненном>> случае, когда ответы нашей программы расположены в интервале на равных промежутках:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/uni_line}
\end{center}
\caption{Равномерное расположение 10 пробных точек в интервале $[0.25; 0.5]$.} \label{img:uni_line}
\end{figure}

Сгенерировав таким равномерным образом несколько наборов <<предсказаний>> нашей программы, можно получить зависимость получаемой оценки погрешности от количетва имеющихся экспериментальных точек:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.64\textwidth]{./pics/linear}
\end{center}
\caption{Зависимость $\varepsilon(N)$ оценки погрешности программы  от количества экспериментальных точек при их равномерном распределении в интервале.} \label{img:linear}
\end{figure}

\newpage

Можно делать так для разных наборов параметров, описанных в геофизической постановке задачи. Приведем некоторые полученные таким образом зависимости для типичных значений параметров:

\begin{table}[h!]
\begin{minipage}[b]{0.6\linewidth}
\centering
\includegraphics[width=1.0\textwidth]{./pics/fig_AB}
\captionof{figure}{Зависимость $\varepsilon(N)$ оценки погрешности программы  от количества экспериментальных точек. Различные интервалы допустимых \emph{Кг}.}
\label{fig:fig_AB}
\end{minipage}\hfill
\begin{minipage}[b]{0.35\linewidth}
\centering
{\Large $N($\emph{Кг}$, \varepsilon)$}
\vspace{10mm}
\begin{tabular}{|l|l|l|} 
\hline
\diagbox{\emph{Кг}}{$\varepsilon$} & 0.05 & 0.02  \\ 
\hline
[0; 1.0]                            & 3    & 7     \\ 
\hline
[0.25; 1.0]                            & 2    & 5     \\ 
\hline
[0.5; 1.0]                            & 1    & 3     \\
\hline
\end{tabular}
    \caption{Минимальные значения N, необходимые для достижения данного $\varepsilon$ при данном \emph{Кг}.}
    \label{table:fig_AB}
\end{minipage}
\end{table}

\newpage

\begin{table}[h!]
\begin{minipage}[b]{0.6\linewidth}
\centering
\includegraphics[width=1.0\textwidth]{./pics/fig_P}
\captionof{figure}{Зависимость $\varepsilon(N)$ оценки погрешности программы  от количества экспериментальных точек. Различные степени доверия эксперименту.}
\label{fig:fig_P}
\end{minipage}\hfill
\begin{minipage}[b]{0.35\linewidth}
\centering
{\Large $N(p_0, \varepsilon)$}
\vspace{10mm}
\begin{tabular}{|l|l|l|} 
\hline
\diagbox{$p_0$}{$\varepsilon$} & 0.05 & 0.02  \\ 
\hline
80\%                            & 2    & 7     \\ 
\hline
90\%                            & 2    & 5     \\ 
\hline
97\%                            & 1    & 4     \\
\hline
\end{tabular}
    \caption{Минимальные значения N, необходимые для достижения данного $\varepsilon$ при данном $p_0$.}
    \label{table:fig_P}
\end{minipage}
\end{table}

\newpage

\begin{table}[ht]
\begin{minipage}[b]{0.6\linewidth}
\centering
\includegraphics[width=1.0\textwidth]{./pics/fig_M}
\captionof{figure}{Зависимость $\varepsilon(N)$ оценки погрешности программы  от количества экспериментальных точек. Различные разбиения типичного интервала.}
\label{fig:fig_M}
\end{minipage}\hfill
\begin{minipage}[b]{0.35\linewidth}
\centering
{\Large $N(M, \varepsilon)$}
\vspace{10mm}
\begin{tabular}{|l|l|l|} 
\hline
\diagbox{$M$}{$\varepsilon$} & 0.05 & 0.02  \\ 
\hline
3                            & 3    & 7     \\ 
\hline
4                            & 2    & 5     \\ 
\hline
5                            & 1    & 4     \\
\hline
\end{tabular}
    \caption{Минимальные значения N, необходимые для достижения данного $\varepsilon$ при данном $M$.}
    \label{table:fig_M}
\end{minipage}
\end{table}

\vspace{10mm}

Может быть также интересен наиболее сложный случай: 

$M = 3$, $p_0 = 80\%$, \emph{Кг} = [0; 1.0]

При таких параметрах для достижения $\varepsilon = 0.05$ нужно $N = 5$, а для $\varepsilon = 0.02$ нужно $N = 12$. Т.е. при наличии \fbox{12 точек} в интервале можно с уверенность говорить о подтверждении хорошей точности метода в данной области \emph{Кг}.

\newpage

\subsection{Теоретический анализ}

На глаз зависимость на Рис. \ref{img:linear} близка к $1/N$, что ожидаемо, т.к. погрешность в основном определяется минимальным расстояние до границы, которое при выбранной расстановке точек убывает как $1/N$. 

Можно проверить отклонения от закона $1/N$ -- рис.(\ref{img:log}).

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/log}
\end{center}
\caption{$\varepsilon(N)$, логарифмический масштаб, попытка линеаризации} \label{img:log}
\end{figure}

Видно, что наклон с правда близок к $-1$, но небольшие отклонения от линейности есть.

\newpage

\section{Описание и рекомендации к программе}

Для удобства применения изложенного метода создана программа, позволяющее получить оценку погрешности для любого заданного набора экспериментов.

Окно программы выглядит так:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_nums}
\end{center}
\caption{Окно программы. 1,2 -- границы анализируемого интервала. 3 -- априорная минимально допустимая погрешность. 4 -- степень доверия эксперименту. 5 -- имеющиеся результаты работы программы. 6 -- сделать расчет с введенными данными.} \label{img:whole_window}
\end{figure}

\newpage

Поясним, что изображено на рисунках:

\subsection{Исследуемый интервал, ввод имеющихся данных}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_interval}
\end{center}
\caption{Значения полей 1 и 2 -- значения $a$ и $b$, т.е. границ исследуемного интервала.} \label{img:whole_interval}
\end{figure}

\newpage

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_interval2}
\end{center}
\caption{Таблица 5 -- имеющиеся ответы программы.} \label{img:whole_interval2}
\end{figure}

\newpage

\subsection{Основной рисунок}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_34}
\end{center}
\caption{Поле 3 -- априорное значение минимально допустимой погрешности. Оно задается по соображениям пользователя исходя из сторонней информации. Поле 4 -- степень доверия эксперименту. Если мы уверены в эксперименте на 95\% -- пишем 0.95. Основная задача программы состоит в использовании этой величины -- по точкам 5 и интервалу 1,2 программа строит голубую кривую и находит тот Х (т.е. тот $\varepsilon$), при котором кривая принимает значение в поле 4 (т.е. вероятность реализации эксперимента совпадает с нашими ожиданиями).} 
\label{img:whole_34}
\end{figure}

\newpage

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_numsLeg}
\end{center}
\caption{Описание легенды. 1 -- зависимость вероятности реализации имеющейся совокупонсти экспериментов от предполагаемой погрешности предсказаний. 2 -- априорно заданная минимальная погрешность. 3 -- минимальное расстояние от заданного множества точек до блжайшей границы интервала. 4 -- степень доверия эксперименту. \fbox{5 -- ответ программы}, получанная оценка погрешности предсказаний.} \label{img:whole_numsLeg}
\end{figure}

\newpage

\printbibliography[heading=bibintoc]

\end{document} % конец документа