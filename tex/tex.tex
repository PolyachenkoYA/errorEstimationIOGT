% "Станет проще"

\documentclass[a4paper,12pt]{article} % тип документа

% report, book

% Рисунки
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{lscape}
\usepackage{biblatex}

\usepackage{hyperref}
\usepackage[rgb]{xcolor}
\hypersetup{				% Гиперссылки
    colorlinks=true,       	% false: ссылки в рамках
	urlcolor=blue          % на URL
}

%  Русский язык

\usepackage[T2A]{fontenc}			% кодировка
\usepackage[utf8]{inputenc}			% кодировка исходного текста
\usepackage[english,russian]{babel}	% локализация и переносы


% Математика
\usepackage{amsmath,amsfonts,amssymb,amsthm,mathtools} 
\DeclarePairedDelimiter\abs{\lvert}{\rvert}%

\addbibresource{tex.bib}

\usepackage{wasysym}

%Заговолок
\author{Поляченко Юрий}
\title{Оценка погрешностей будущих измерений \\ по имеющимся данным}
\date{\today}

\begin{document} % начало документа

\clearpage\maketitle
\thispagestyle{empty}

\newpage

\section{Постановка задачи}

Цель -- предсказать погрешность $\varepsilon_0$ выдаваемых нашей программой значений $x$ искомого параметра $y$.

Область изменения $x \in [0;1]$ разбита на интервалы $[a_j; b_j]$, для каждого из которых есть $N_j$ экспериментов. Считается, что искомая погрешность $\varepsilon_0$ может меняться от интервала к интервалу, но постоянная внутри интервала (т.е. точнее писать $\varepsilon_{0j}$). Фиксируем $j$ и работаем в выбранном интервале, поэтому далее индекс интервала $j$ опущен.

Есть $N$ экспериментов, про которые известно, что в каждом из них истинное значение $y_i$ попало в интервал, т.е. $y_i \in [a;b]$ $\forall i \subset \left\{\overline{1,N}\right\}$. На каждый из этих экспериментов у нас есть результат работы нашей программы $x_i$. Предполагается, что истинное значение $y_{i}$ распределено по Гауссу со средним $x_i$ и некой дисперсией $\varepsilon$, т.е.

\begin{equation}
\dfrac{\mathcal{P}(y_i \in [t, t+dt])}{dt} = g(t, x_i, \varepsilon), 
\end{equation}

где $\mathcal{P}(A)$ - вероятность того, что $A$ верно, а

\begin{equation}
g(x, \mu, \sigma) = \dfrac{1}{\sigma \sqrt{2 \pi}} \exp{\left[ - \dfrac{1}{2} \left( \dfrac{x - \mu}{\sigma} \right)^2 \right]}
\end{equation}

-- Гауссово распределение.

Ищем зависимость

\begin{equation}
\varepsilon_0 \left( a, b, \{x_i\}_{i = 1}^{N}, p_0 \right)
\end{equation}

такую, что вероятность реализации описанной выше ситуации (т.е. что все истинные значения попали в интервал) $ = p_0$, т.е.

\begin{equation}
\mathcal{P}(\forall x \in [a;b] \hspace{5pt} |x - y| < \varepsilon_0) = p_0
\end{equation}

Из сторонних соображений считается известным минимально возможная погрешность $\varepsilon_{min}$, т.е. если метод выдает $\varepsilon_0 < \varepsilon_{min}$, то считаем $\varepsilon_0 = \varepsilon_{min}$.

\newpage

\section{Предлагаемое решение}

\subsection{Идея и приближения}

Задав $\varepsilon$, можно посчитать вероятность реализации ситуации, описанной в постановке -- попадания всех истинных значений параметра $y_i$, распределенных по Гауссу каждый около своего $x_i$, в интервал $[a;b]$. Далее предположение - эта вероятность равна нашей целевой вероятность $p_0$. Не очевидно, почему это должно выполняться точно (скорее всего это не выполняется), но для оценки предложено использовать такую модель. 

Поясним разумность данного выбора. Будем брать пробные $\varepsilon$ и смотреть как от этого зависит ожидаемое поведение истинных значений $y_i$ относительно наших точек $x_i$. Для примера возьмем весь интервал $[0.2; 0.5]$ и предположим что у нас имеются 5 точек, для которых наша программа выдала ответы 0.22, 0.3, 0.35, 0.4, 0.43. Если предположить, что погрешность наший предсказаний $\varepsilon = 0.02$, то плотность вероятности для каждого из 5 истинных значений будет выглядет так:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_med}
\end{center}
\caption{Разным цветам отвечают разные эксперименты. Для каждого эксперимента: проколотый круг на оси Х -- наше предсказание ответа, купол -- распределение плотности вероятности того, что истинное значение ответа примет значение $t$, в зависиомсти от $t$.} \label{img:peaks_med}
\end{figure}

На Рис. \ref{img:peaks_med} видно, что для всех точек кроме синей почти вся кривая (вероятность = площать под кривой) находится в исследуемом интервале. Это значит, что при $\varepsilon = 0.02$ для всех точек кроме синей вероятность того, что интинное значение параметра попадет в интервал, равна почти 100\%. Синяя же точка находится на расстоянии $\sim 1 \sigma$ (в данном случае 0.02), что значит, что вероятность того, что истинное значение параметра в синем эксперименте попадет в интервал $[0.2; 0.5]$ будет $\approx 16 \%$. Попадания истинных значений в интервал -- события независимые, поэтому вероятность реализации картины в целом будет произведением вероятностей попадания каждого значения в интервал по отдельности. В нашем случае все вероятности кроме синей $\approx 1$, поэтому общая вероятность $\approx$ синяя вероятность $\approx$ 84\%. Это значит, что если бы погрешность нашей программы была 0.02, то вероятность случатся тому что случилось на рассматриваемых 5 экспериментах в совокупности была бы 84 \%. Поняв это, можно решить обратную задачу: сказать, что мы верим эксперименту на скажем 95\%, и найти такое $\varepsilon$, при котором вероятность его реализации как раз будет 95\%. Понятно, что задача решаема -- если в предыдущем примере мы возьмем $\varepsilon = 0.008$, то распределение вероятностей для истинных значений будет 

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_sharp_med}
\end{center}
\caption{Обозначения аналогичны Рис. \ref{img:peaks_med}. Вероятность реализации эксперимента >99\%, что эквивалентно практически полному доверию эксперименту.} \label{img:peaks_sharp_med}
\end{figure}

\newpage

Если же все наши экспериментальные точки лежат ближе к центру исследуемой области, то оценка на погрешность выходит грубой. Это понятно из следующего примера. Сдвинем точку 0.22 из предыдущего примера в точку 0.28. График для $\varepsilon = 0.04$ будет выглядить как

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.7\textwidth]{./pics/peaks_smooth}
\end{center}
\caption{Обозначения аналогичны Рис. \ref{img:peaks_med}. Вероятность реализации эксперимента 92.5\%.} \label{img:peaks_smooth}
\end{figure}

Т.е. при налиции точки 0.22, близкой к левой границе иследуемого интервала 0.2, вероятность реализации эксперимента уже при $\varepsilon = 0.02$ была 84\%, что говорило о том, что в реальности скорее всего погрешность была меньше. Здесь же даже при $\varepsilon = 0.04$ вероятность все еще >90\%. Это на самом деле логично, т.к. если все наши точки у центра интервала, то единственный известный нам факт (на котором и строится вся оценка опгрешности) о том, что все истинные значения попали в интервал, поволяет отбросить только самые большие значения погрешностей.

Заинтересовавшийся читатель может найти весь инходный код проекта и мои контакты для вопросов и предложений \href{https://github.com/PolyachenkoYA/errorEstimationIOGT}{здесь}. В частности по ссылке лежит программа для оценки ошибок по описываемому здесь методу.

Теперь приведем аналитическое выражение описанной идеи:

\newpage

\subsection{Аналитика}

Вероятность попадания $i$-ой истинной точки в интервал

\begin{equation}
p_i(\varepsilon) = \int\limits_a^b g \left(x, x_i, \varepsilon \right) dx = \int\limits_{(a-x_i)/\varepsilon}^{(b-x_i)/\varepsilon} g(x, 0, 1) dx.
\end{equation}

Введем функцию (известную как функция ошибок):

\begin{equation}
\textsf{erf}(x) = \int\limits_{- \infty}^x g(t, 0, 1) dt.
\end{equation}

Попадание каждого истинного значения в интервал - независимое событие, поэтому вероятность реализации нашей совокупности экспериментов

\begin{equation}
p(\varepsilon) = \prod_{i = 1}^N p_i(\varepsilon) = \prod_{i = 1}^N \left[ \textsf{erf} \left( \dfrac{b - x_i}{\varepsilon} \right) - \textsf{erf} \left( \dfrac{a - x_i}{\varepsilon} \right) \right]
\end{equation}

Для нахождения желаемого $\varepsilon_0$ решаем уравнение на $\varepsilon_0$ при заданном $p_0$.

\begin{equation}
p(\varepsilon_0) = p_0
\end{equation}

Уравнения явно не решается аналитически. Но несложно показать, что функция $p(\varepsilon)$ монотонна, а интервал изменения $\varepsilon$ известен и невелик, откуда следует, что уравнени легко решается численно даже самыми простейшими методами вроде деления отрезка пополам. В примерах использован алгоритм, реализованный в функции $fzero$ в Matlab и описанный в \cite{grund1979forsythe}

\newpage

\subsection{Продолжение примера аналитикой}

Продолжим использовать 5 точек из раздела 2.1. В разделе разделе 2.1 был описан алгоритм как мы задавшись определенным $\varepsilon$ можем оценить вероятность $p$, с которой при этом $\varepsilon$ реализовались бы имеющиеся у нас экспериментальные данные. Сделав так для мноих различных $\varepsilon$, можно для каждого из них получить свое значение $p(\varepsilon)$ (Синяя кривая на Рис. \ref{img:vis}).

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/vis}
\end{center}
\caption{Зависимость $p(\varepsilon)$ вероятности реализации эксперимента при данной погрешности программы. Красная линия -- принятая минимально возможная погрешность $\varepsilon_{min} = 0.02$, Синяя вертикаль -- найденная оценка, синяя горизонталь -- наш выбор $p_0 = 95\%$, зеленый пунктир - минимальное расстояние точек до границы.}
\label{img:vis}
\end{figure}

Видно, что наличие множества (> 1) точек позволяет улучшить оценку с очевидного значения минимального расстояния до границы -- синяя линяя линия левее зеленой, т.е. оценка по предлагаемому методу лучше чем наивная оценка сверху на глаз.

\newpage

\section{Результат применения}

Можно исследовать, как оценка погрешности зависит от количества имеющихся экспериментальных данных в <<усредненном>> случае, когда ответы нашей программы расположены в интервале на равных промежутках:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/uni_line}
\end{center}
\caption{Равномерное расположение 10 пробных точек в интервале $[0.25; 0.5]$.} \label{img:uni_line}
\end{figure}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=0.8\textwidth]{./pics/linear}
\end{center}
\caption{Зависимость $\varepsilon(N)$ оценки погрешности программы  от количества экспериментальных точек при их равномерном распределении в интервале.} \label{img:linear}
\end{figure}

\newpage

На глаз зависимость на Рис. \ref{img:linear} близка к $1/N$, что ожидаемо, т.к. погрешность в основном определяется минимальным расстояние до границы, которое при выбранной расстановке точек убывает как $1/N$. 

Можно проверить отклонения от закона $1/N$ -- рис.(\ref{img:log}).

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/log}
\end{center}
\caption{$\varepsilon(N)$, логарифмический масштаб, попытка линеаризации} \label{img:log}
\end{figure}

Видно, что наклон с правда близок к $-1$, но небольшие отклонения от линейности есть.

\newpage

\section{Описание и рекомендации к программе}

Для удобства применения изложенного метода создана программа, позволяющее получить оценку погрешности для любого заданного набора экспериментов.

Окно программы выглядит так:

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_nums}
\end{center}
\caption{Окно программы. 1,2 -- границы анализируемого интервала. 3 -- априорная минимально допустимая погрешность. 4 -- степень доверия эксперименту. 5 -- имеющиеся результаты работы программы. 6 -- сделать расчет с введенными данными.} \label{img:whole_window}
\end{figure}

\newpage

Поясним, что изображено на рисунках:

\subsection{Исследуемый интервал, ввод имеющихся данных}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_interval}
\end{center}
\caption{Значения полей 1 и 2 -- значения $a$ и $b$, т.е. границ исследуемного интервала.} \label{img:whole_interval}
\end{figure}

\newpage

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_interval2}
\end{center}
\caption{Таблица 5 -- имеющиеся ответы программы.} \label{img:whole_interval2}
\end{figure}

\newpage

\subsection{Основной рисунок}

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_34}
\end{center}
\caption{Поле 3 -- априорное значение минимально допустимой погрешности. Оно задается по соображениям пользователя исходя из сторонней информации. Поле 4 -- степень доверия эксперименту. Если мы уверены в эксперименте на 95\% -- пишем 0.95. Основная задача программы состоит в использовании этой величины -- по точкам 5 и интервалу 1,2 программа строит голубую кривую и находит тот Х (т.е. тот $\varepsilon$), при котором кривая принимает значение в поле 4 (т.е. вероятность реализации эксперимента совпадает с нашими ожиданиями).} 
\label{img:whole_34}
\end{figure}

\newpage

\begin{figure}[h!]
\begin{center}
\includegraphics[width=1\textwidth]{./pics/whole_window_numsLeg}
\end{center}
\caption{Описание легенды. 1 -- зависимость вероятности реализации имеющейся совокупонсти экспериментов от предполагаемой погрешности предсказаний. 2 -- априорно заданная минимальная погрешность. 3 -- минимальное расстояние от заданного множества точек до блжайшей границы интервала. 4 -- степень доверия эксперименту. \fbox{5 -- ответ программы}, получанная оценка погрешности предсказаний.} \label{img:whole_numsLeg}
\end{figure}

\newpage

\printbibliography

\end{document} % конец документа